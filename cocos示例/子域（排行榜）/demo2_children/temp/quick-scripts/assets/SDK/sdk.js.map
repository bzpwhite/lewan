{"version":3,"sources":["sdk.js"],"names":["sdk","app_name","createImage","sprite","url","cc","sys","platform","WECHAT_GAME","image","wx","onload","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","src","postMessage","msg","message","onMessage","callback","d","setUserCloudStorage","kvDataList","KVDataList","success","res","fail","getUserCloudStorage","keyList","getGroupCloudStorage","shareTicket","getFriendCloudStorage","sortList","ListData","key","order","sort","a","b","AMaxScore","i","length","value","BMaxScore","parseInt","getMyRank","me","dataList","avatarUrl","nickname","nickName","isSelf","rank","push","module","exports","window"],"mappings":"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","file":"sdk.js","sourceRoot":"..\\..\\..\\..\\assets\\SDK","sourcesContent":["var sdk = {\r\n    app_name: '',\r\n\r\n    //.加载图片\r\n    createImage(sprite,url){\r\n        //.当前运行环境是小游戏，可以调用微信api接口wx.\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            let image = wx.createImage();\r\n            image.onload = function () {\r\n                let texture = new cc.Texture2D();\r\n                texture.initWithElement(image);\r\n                texture.handleLoadedTexture();\r\n                sprite.spriteFrame = new cc.SpriteFrame(texture);\r\n            };\r\n            image.src = url;\r\n        }\r\n    },\r\n    //msg参数: Object\r\n    postMessage(msg){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.postMessage({ message: msg });\r\n        }\r\n    },\r\n    onMessage(callback){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.onMessage(function(d){\r\n                // if(d.message == \"common_back\"){//.子域: 返回子域首页\r\n                //     cc.director.loadScene(\"common_children\")\r\n                // }\r\n                callback(d)\r\n            });\r\n        }\r\n    },\r\n    //.主域上报数据:    对用户托管数据进行写数据操作，允许同时写多组 KV 数据。\r\n    setUserCloudStorage(kvDataList, callback){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.setUserCloudStorage({\r\n                KVDataList: kvDataList,\r\n                success(res){\r\n                    callback(res)\r\n                },\r\n                fail(res){\r\n                    callback(res)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    //.获取当前用户托管数据当中对应 key 的数据。该接口只可在开放数据域下使用\r\n    getUserCloudStorage(keyList, callback){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.getUserCloudStorage({\r\n                keyList: keyList,\r\n                success(res){\r\n                    callback(res)\r\n                },\r\n                fail(res){\r\n                    callback(res)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    //.在小游戏是通过群分享卡片打开的情况下，可以通过调用该接口获取群同玩成员的游戏数据。该接口只可在开放数据域下使用。\r\n    getGroupCloudStorage(shareTicket, keyList, callback){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.getGroupCloudStorage({\r\n                shareTicket: shareTicket,\r\n                keyList: keyList,\r\n                success(res){\r\n                    callback(res)\r\n                },\r\n                fail(res){\r\n                    callback(res)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    //.拉取当前用户所有同玩好友的托管数据。该接口只可在开放数据域下使用\r\n    getFriendCloudStorage(keyList, callback){\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            wx.getFriendCloudStorage({\r\n                keyList: keyList,\r\n                success(res){\r\n                    callback(res)\r\n                },\r\n                fail(res){\r\n                    callback(res)\r\n                }\r\n            })\r\n        }\r\n    },\r\n\r\n    //.对排行榜数据进行排序。   \r\n        // order:   true正序  false倒序  \r\n        // field:   要排序的key\r\n    sortList(ListData, key, order){\r\n        ListData.sort(function(a,b){\r\n            var AMaxScore = 0;\r\n            var KVDataList = a.KVDataList;\r\n            for(var i=0; i<KVDataList.length; i++){\r\n                if(KVDataList[i].key == key){\r\n                    AMaxScore = KVDataList[i].value;\r\n                }\r\n            }\r\n\r\n            var BMaxScore = 0;\r\n            KVDataList = b.KVDataList;\r\n            for(var i=0; i<KVDataList.length; i++){\r\n                if(KVDataList[i].key == key){\r\n                    BMaxScore = KVDataList[i].value;\r\n                }\r\n            }\r\n\r\n            if(order){\r\n                return parseInt(AMaxScore) - parseInt(BMaxScore);\r\n            }else{\r\n                return parseInt(BMaxScore) - parseInt(AMaxScore);\r\n            }\r\n        });\r\n        return ListData;\r\n    },\r\n    //.与我相邻的好友\r\n    getMyRank(ListData,me){\r\n        var dataList = [];\r\n        for(var i=0; i<ListData.length; i++){\r\n            if(ListData.length <= 3){\r\n                //.只有3个人或以下\r\n                if(ListData[i].avatarUrl == me.avatarUrl && ListData[i].nickname == me.nickName){\r\n                    ListData[i].isSelf = true;//.标记自己\r\n                }\r\n                dataList = ListData;\r\n                for(var i=0; i<dataList.length; i++){\r\n                    dataList[i].rank = i;\r\n                }                 \r\n            }else{\r\n                if(ListData[i].avatarUrl == me.avatarUrl && ListData[i].nickname == me.nickName){\r\n                    ListData[i].isSelf = true;//.标记自己\r\n                    if(i == ListData.length-1){\r\n                        //.自己分数最低\r\n                        ListData[i].rank = i;\r\n                        ListData[i-1].rank = i-1;\r\n                        ListData[i-2].rank = i-2;\r\n                        dataList.push(ListData[i-2])\r\n                        dataList.push(ListData[i-1])\r\n                        dataList.push(ListData[i])\r\n                    }else if(i==0){\r\n                        //.自己分数最高\r\n                        ListData[i].rank = i;\r\n                        ListData[i+1].rank = i+1;\r\n                        ListData[i+2].rank = i+2;\r\n                        dataList.push(ListData[i])\r\n                        dataList.push(ListData[i+1])\r\n                        dataList.push(ListData[i+2])\r\n                    }else{\r\n                        //.居中\r\n                        ListData[i-1].rank = i-1;\r\n                        ListData[i].rank = i;\r\n                        ListData[i+1].rank = i+1;\r\n                        dataList.push(ListData[i-1])\r\n                        dataList.push(ListData[i])\r\n                        dataList.push(ListData[i+1])\r\n                    }\r\n                    break;        \r\n                }\r\n            }\r\n               \r\n        }\r\n        return dataList;\r\n    }\r\n\r\n\r\n\r\n    \r\n}\r\nmodule.exports = sdk;\r\nwindow.sdk = sdk;"]}